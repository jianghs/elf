# 基于 TCP 的 Socket 通信

## 短连接

优点：服务端不需要保存多个Socket对象，降低内存占用率

缺点：客户端需要和服务端每次传输数据时都与服务端握手，增加了处理时间。

## 长连接

优点：除了第一次，客户端不需要和服务端每次传输数据时都与服务端握手，提高运行效率。

缺点：服务端需要保存多个Socket对象，大量占用内存

## 服务端

服务端会阻塞，直到客户端获取连接。

关闭Stream时，会报socket关闭异常，因为InputStream真正的数据累心管事SocketInputStream。

## 三次握手
第一次：客户端向服务端发送SYN标志位，与服务段建立连接。SYN标志位表示发送数据流序号的最大值。为此握手的SYN为0。

第二次：服务端向客户端发送SYN和ACK，ACK是对收到数据包的确认，说明收到客户端的连接。SYN同第一次。ACK=1表示下次期望从客户端收到Seq=1的数据流。

第三次：客户端向服务端发送ACK和Seq。

## 四次挥手

第一次：客户端到服务端：我关了

第二次：服务端到客户端：好的，收到

第三次：服务端到客户端：我也关了

第四次：客户端到服务端：好的，收到

## TCP为什么需要3次握手与4次挥手

三次握手，server收到此失效的连接请求报文段后，就误认为是client再次发出的一个新的连接请求。于是就向client发出确认报文段，同意建立连接。假设不采用“三次握手”，那么只要server发出确认，新的连接就建立了。由于现在client并没有发出建立连接的请求，因此不会理睬server的确认，也不会向server发送数据。但server却以为新的运输连接已经建立，并一直等待client发来数据。这样，server的很多资源就白白浪费掉了。

四次挥手，关闭连接时，当收到对方的FIN报文时，仅仅表示对方不再发送数据了但是还能接收数据，我们也未必全部数据都发送给对方了，所以我们不可以立即close，也可以发送一些数据给对方后，再发送FIN报文给对方来表示同意现在关闭连接，因此，我们的ACK和FIN一般都会分开发送。

## 握手时机

服务端与客户端握手是在ServerSocket对象创建出来并且绑定到指定的地址和端口时。